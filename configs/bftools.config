// nextflow.config

profiles {
  docker {
    // docker.runOptions = '-u $(id -u):$(id -g)' // running as user is a bad idea in this case. mc cannot save the config file due to permissions
    docker.enabled = true
    docker.fixOwnership = true
    process {
      executor = 'local'
      container = 'bugraoezdemir/bconv:minimised'
      // container = 'bugraoezdemir/bconv:minimised'
    }
    workDir = params.workdir
    tmpDir = "${baseDir}/WorkDir/tmp"
  }
  singularity {
    singularity.enabled = true
    singularity.cacheDir = "${baseDir}/.singularityCache"
    singularity.autoMounts = true
	//singularity.RunOptions = "--no-home"
    process {
      executor = 'local'
      container = 'docker://bugraoezdemir/bconv:minimised'
      containerOptions = "-B ${baseDir}/bin -B ${baseDir}/WorkDir/work -B params.workdir -B $PWD"
    }
    workDir = params.workdir
    tmpDir = "${baseDir}/WorkDir/tmp"
  }
  conda {
    conda.enabled = true
    conda.cacheDir = "${baseDir}/.condaCache"
    process {
      executor = 'local'
      conda = "${baseDir}/dependencies/environment.yml"
    }
    workDir = params.workdir
    tmpDir = "${baseDir}/WorkDir/tmp"
  }
  manual {
    process {
      executor = 'local'
    }
    workDir = params.workdir
    tmpDir = "${baseDir}/WorkDir/tmp"
  }
  cluster {
    singularity.enabled = true
    singularity.cacheDir = "${baseDir}/.singularityCache"
    singularity.autoMounts = true
    process {
      executor = 'slurm'
      queueSize = params.queue_size
      submitRateLimit = params.submit_rate_limit
      clusterOptions = params.cluster_options
      time = '6h'
      container = 'docker://bugraoezdemir/bconv:minimised'
      containerOptions = "-B ${baseDir}/bin -B /scratch/.batchconvert/work -B params.workdir -B $PWD"
    }
    workDir = params.workdir
    tmpDir = "/scratch/.batchconvert/tmp"
  }
}

env {
    BIA_SSH_KEY = "${baseDir}/configs/asperaweb_id_dsa.openssh"
}

// cleanup = true
